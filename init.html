<style type="text/css">
    #drawsocket {
        top: 0px;
    }

    #border {
        fill: #ddffff;
        fill-opacity: 0.2;
        stroke: none;
    }

    .arm {
        stroke-width: 2px;
        opacity: 0.5;
        transition: opacity 1s;
    }
    .arm:hover {
        opacity: 1;
    }

    .splash:hover, [class|=arrow]>polygon:hover {
        stroke-width: 3px;
    }
    .splash:active,[class|=arrow]>polygon:active {
        stroke-width: 5px;
        transition: none;
    }
    .splash,[class|=arrow]>polygon {
        stroke: currentColor;
        fill: currentColor;
        fill-opacity: 0.3;
        transition: stroke-width 1s;
    }
    [class|=splash] {
        color: Orange;
    }

    .direction polygon {
        stroke: none;
        fill: skyblue;
    }

    .splash-bomb {
        fill: currentColor;
        stroke: none;
        opacity: 0;
    }
    .splash-bomb.boom {
        opacity: 0;
        transform: scale(3);
        transition: opacity 2s, transform 2s;
    }

    [class|=arrow]>polygon {
        color: lightskyblue;
    }

    .selectbox {
        opacity: 0;
    }
</style>

<svg xmlns="http://www.w3.org/2000/svg" style="overflow: visible;">
    <rect id="border" x="0" y="0" width="300" height="400"></rect>
    <g id="main_controller">
        <g id="arm-1" class="arm" transform="translate(150, 50)">
            <rect class="selectbox" x="-150" y="-50" width="300" height="100" />
            <g class="arrow-left">
                <polygon points="-50,10 -50,-10 -100,-10 -100,-20 -120,0 -100,20 -100,10" onclick="sendToController({arm:1,button:'left'});" />
            </g>
            <g class="arrow-right">
                <polygon points="50,10 50,-10 100,-10 100,-20 120,0 100,20 100,10" onclick="sendToController({arm:1,button:'right'});" />
            </g>
            <g class="splash">
                <circle cx="0" cy="0" r="20" onclick="sendToController({arm:1,button:'splash'});" />
            </g>
            <g id="direction-1" class="direction">
                <polygon points="5,30 -5,30 0,50" />
            </g>
            <g id="splash-bomb-1" class="splash-bomb">
                <circle cx="0" cy="0" r="20" />
            </g>
        </g>
        <g id="arm-2" class="arm" transform="translate(150, 150)">
            <rect class="selectbox" x="-150" y="-50" width="300" height="100" />
            <g class="arrow-left">
                <polygon points="-50,10 -50,-10 -100,-10 -100,-20 -120,0 -100,20 -100,10" onclick="sendToController({arm:2,button:'left'});" />
            </g>
            <g class="arrow-right">
                <polygon points="50,10 50,-10 100,-10 100,-20 120,0 100,20 100,10" onclick="sendToController({arm:2,button:'right'});" />
            </g>
            <g class="splash">
                <circle cx="0" cy="0" r="20" onclick="sendToController({arm:2,button:'splash'});" />
            </g>
            <g id="direction-2" class="direction">
                <polygon points="5,30 -5,30 0,50" />
            </g>
        </g>
        <g id="arm-3" class="arm" transform="translate(150, 250)">
            <rect class="selectbox" x="-150" y="-50" width="300" height="100" />
            <g class="arrow-left">
                <polygon points="-50,10 -50,-10 -100,-10 -100,-20 -120,0 -100,20 -100,10" onclick="sendToController({arm:3,button:'left'});" />
            </g>
            <g class="arrow-right">
                <polygon points="50,10 50,-10 100,-10 100,-20 120,0 100,20 100,10" onclick="sendToController({arm:3,button:'right'});" />
            </g>
            <g class="splash">
                <circle cx="0" cy="0" r="20" onclick="sendToController({arm:3,button:'splash'});" />
            </g>
            <g id="direction-3" class="direction">
                <polygon points="5,30 -5,30 0,50" />
            </g>
        </g>
        <g id="arm-4" class="arm" transform="translate(150, 350)">
            <rect class="selectbox" x="-150" y="-50" width="300" height="100" />
            <g class="arrow-left">
                <polygon points="-50,10 -50,-10 -100,-10 -100,-20 -120,0 -100,20 -100,10" onclick="sendToController({arm:4,button:'left'});" />
            </g>
            <g class="arrow-right">
                <polygon points="50,10 50,-10 100,-10 100,-20 120,0 100,20 100,10" onclick="sendToController({arm:4,button:'right'});" />
            </g>
            <g class="splash">
                <circle cx="0" cy="0" r="20" onclick="sendToController({arm:4,button:'splash'});" />
            </g>
            <g id="direction-4" class="direction">
                <polygon points="5,30 -5,30 0,50" />
            </g>
        </g>
    </g>
</svg>

<script>
    function sendToController(obj) {
        drawsocket.sendRoomMessage({
            controller: {
                key: 'maxOutput',
                val: obj
            }
        })
    }

    function boom(arm) {
        const bomb = document.getElementById('splash-bomb-'+arm);
        bomb.setAttribute('class','splash-bomb boom');
    }

    function init() {
        // remove UI bar on top
        const ui_div = document.getElementById('default_ui');
        const localUI_div = document.getElementById('local_ui');

        ui_div.parentElement.removeChild(ui_div);
        localUI_div.parentElement.removeChild(localUI_div);
        
        const log = document.getElementById('statusDiv');
        log.style.visibility = "hidden";

        window.addEventListener("beforeunload", () => {
            sendToController({addParticipant: -1});
        });
    }

    sendToController({addParticipant: 1});
    init();
</script>
